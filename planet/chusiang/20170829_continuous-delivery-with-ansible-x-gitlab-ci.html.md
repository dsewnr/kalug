---
title: "DevOps 人一定要知道的 Ansible & GitLab CI 持續交付技巧"
date: 2017-08-29
type: blog
author: 凍仁翔
link: http://note.drx.tw/2017/08/continuous-delivery-with-ansible-x-gitlab-ci.html
layout: post
comments: true
---

因緣際會下，凍仁先後於 COSCUP 2017 和 DevOps Taiwan x Agile Kaohsiung 的社群活動分享「使用 Ansible x GitLab CI 進行持續交付」的主題。<br /><br />前者是接續 <a href="https://smalltowntechblog.com/" target="_blank" title="'小城故事不多 - 科技部' 作者">Smalltown</a> 的 <a href="https://www.slideshare.net/smalltown20110306/coscup-2017-infrastructure-as-code" target="_blank">Infrastructure as Code</a>，之後讓 <a href="http://chengweichen.com/" target="_blank">Cheng Wei Chen</a> 分享 <a href="http://blog.chengweichen.com/2017/08/coscup-2017-ansible-gitlab-cicd.html" target="_blank">Ansible &amp; GitLab CI/CD workshop 101</a> 進行更詳盡的實作面解說；後者則是接續 <a href="http://chengweichen.com/" target="_blank">Cheng Wei Chen</a> 的 <a href="https://www.slideshare.net/warfan/effective-devops-78979993" target="_blank">Effective DevOps：一場文化與技術的轉型運動</a>之後分享。<br /><br /><div style="text-align: center;"><script async="" class="speakerdeck-embed" data-id="1ae659ed34c24fe887922ca27769eb07" data-ratio="1.33333333333333" src="//speakerdeck.com/assets/embed.js"></script><br />▲ <a href="https://www.slideshare.net/freezejonny/continuous-delivery-with-ansible-x-gitlab-ci" target="_blank">Continuous Delivery with Ansible x GitLab CI</a> by Chu-Siang Lai.</div><a name='more'></a><br />第一場簡報的小檢討：<br /><ol><li>暗色系簡報較不利投影，建議於開講前先行公開簡報，以降低投影效果不彰問題。</li><li>淺灰色、深紅色、深藍色投影出來的文字辨識度不高，不建議使用。</li><li>程式碼範例建議使用白底，儘可能使用較大的字體。</li><li>文字過多，詳細內容應從講者口中得知，而不是直接寫在簡報上。</li><li>時間掌握度不足，並導致練習實作的時間大大縮短。</li></ol><br /><div style="text-align: center;"><script async="" class="speakerdeck-embed" data-id="5ca8e57a2c5642c48d06fd7643f5799f" data-ratio="1.33333333333333" src="//speakerdeck.com/assets/embed.js"></script><br />▲ <a href="https://www.slideshare.net/freezejonny/continuous-delivery-withansible-x-gitlab-ci-2e" target="_blank">Continuous Delivery with Ansible x GitLab CI (2e)</a> by Chu-Siang Lai.</div><br />第二場上台前的小調整：<br /><ol><li>先找台單槍投影機試播，直接從投影後的結果進行微調。</li><li>透明度需低於 70%，否則投影後效果不彰。</li><li>參照 <a href="https://github.com/chriskempson/tomorrow-theme" target="_blank">Tomorrow theme</a> 設置語法突顯 (Syntax highlighting)。</li><li>將藍色、紅色等顏色明度調整至 38%，以利投影。</li><li>移除較不重要的章節、實作，以縮短到 40 分鐘內講得完的頁數。</li><li>預先將實作部份錄製成影本，並大幅縮短等待時間，(約從 1 小時縮短至 7 分鐘)。</li></ol><div style="text-align: center;"><iframe allowfullscreen="" frameborder="0" height="315" src="https://www.youtube.com/embed/QHim_JxB4ZY?rel=0" width="560"></iframe><br />▲ <a href="https://youtu.be/QHim_JxB4ZY" target="_blank">Demo viedo for Continuous Delivery with Ansible x GitLab CI</a>.</div><br />從 2016 年至今，凍仁已陸續於各個社群分享了 7 場與 Ansible 有關的主題，大致可分為以下 4 個面向，其簡報可從 <a href="http://wiki.drx.tw/#!presentation.md" target="_blank">http://wiki.drx.tw/#!presentation.md</a> 取得。<br /><ol><li><b>Ansible 入門</b>：初期建議搭配 Docker 和 Jupyter 進行實作。</li><li><b>Ansible Roles 進階入門</b>：當 Ansible 越寫越複雜時，我們可以透過 Roles 來簡化 Playbboks。</li><li><b>混用 Ansible 建置 Docker images</b>：將 Ansible 應用到建置 Docker images，用一份 Playbooks 同時建置實體機器、VM 與 Docker Container 的概念。</li><li><b>使用 Ansible 和 GitLab CI 進行持續交付</b>：將 Ansible 推廣至企業，縮短交付週期，並減少例外工作。</li></ol><br /><div style="text-align: center;"><iframe width="560" height="315" src="https://www.youtube.com/embed/ZF-C7vkhjMI?rel=0" frameborder="0" allowfullscreen></iframe><br />▲ <a href="https://youtu.be/ZF-C7vkhjMI" target="_blank">COSCUP 2017 現場直播影片 (上)</a>。</div><br /><div style="text-align: center;"><iframe width="560" height="315" src="https://www.youtube.com/embed/7VDU8Gq3kD4?rel=0" frameborder="0" allowfullscreen></iframe><br />▲ <a href="https://youtu.be/7VDU8Gq3kD4" target="_blank">COSCUP 2017 現場直播影片 (下)</a>。</div><br />本次主題屬 Ansible 和 GitLab CI 的進階應用，若本身對組態管理工具、持續整合 (CI, Continuous Integration) 和自動化部署較無實務經驗，可能無法馬上進入狀況。相信這點是可以藉由加強基礎說明和實作來補助，但凍仁還是想在超過 2 小時以上的場次再分享進階的主題會比較合適。<br /><br />最後就讓凍仁以帥氣的活動照收尾了！<br /><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="https://1.bp.blogspot.com/-U39R4En3RcQ/WaWghNsnjOI/AAAAAAAAgrc/7eb4C8F-n_QaiQaee1A35IkB3cHYh61SACLcBGAs/s1600/2017-08-05-coscuo2017-00.jpg" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" data-original-height="900" data-original-width="1600" height="225" src="https://1.bp.blogspot.com/-U39R4En3RcQ/WaWghNsnjOI/AAAAAAAAgrc/7eb4C8F-n_QaiQaee1A35IkB3cHYh61SACLcBGAs/s400/2017-08-05-coscuo2017-00.jpg" width="400" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">▲ 活動還未開始就先爆滿的 Room 307 by Chu-Siang Lai。 </td></tr></tbody></table><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="https://3.bp.blogspot.com/-xD2ndQ2Om_k/WaWgfPgKPLI/AAAAAAAAgrM/-S2vhn3FpjERF8VC6cTrMMUpQDmKzRvBACLcBGAs/s1600/2017-08-05-coscuo2017-01.jpg" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" data-original-height="1068" data-original-width="1600" height="266" src="https://3.bp.blogspot.com/-xD2ndQ2Om_k/WaWgfPgKPLI/AAAAAAAAgrM/-S2vhn3FpjERF8VC6cTrMMUpQDmKzRvBACLcBGAs/s400/2017-08-05-coscuo2017-01.jpg" width="400" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">▲ 講者晚宴獲得的小旗子 by Aminzai Wang。(照片來源：<a href="https://flic.kr/p/WgG7wZ" target="_blank">https://flic.kr/p/WgG7wZ</a>)</td></tr></tbody></table><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="https://1.bp.blogspot.com/-T6oydSWClw0/WaWgeGEenVI/AAAAAAAAgrI/-RayomNZGcQ9X6FGHFajnbdiJLTT74lKgCLcBGAs/s1600/2017-08-05-coscuo2017-02.jpg" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" data-original-height="1068" data-original-width="1600" height="266" src="https://1.bp.blogspot.com/-T6oydSWClw0/WaWgeGEenVI/AAAAAAAAgrI/-RayomNZGcQ9X6FGHFajnbdiJLTT74lKgCLcBGAs/s400/2017-08-05-coscuo2017-02.jpg" width="400" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">▲ 講者視角 by Aminzai Wang。(照片來源：<a href="https://flic.kr/p/Xg7VZw" target="_blank">https://flic.kr/p/Xg7VZw</a>)</td></tr></tbody></table><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="https://4.bp.blogspot.com/-nbH7tEZaZdE/WaWgftDgpBI/AAAAAAAAgrQ/GiZV-yBD-rEABiParhjTBsmdkkbcIxvBACLcBGAs/s1600/2017-08-05-coscuo2017-03.jpg" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" data-original-height="1068" data-original-width="1600" height="266" src="https://4.bp.blogspot.com/-nbH7tEZaZdE/WaWgftDgpBI/AAAAAAAAgrQ/GiZV-yBD-rEABiParhjTBsmdkkbcIxvBACLcBGAs/s400/2017-08-05-coscuo2017-03.jpg" width="400" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">▲ 個人很喜歡很帥氣講者照 by Aminzai Wang。(照片來源：<a href="https://flic.kr/p/Xv4TE8" target="_blank">https://flic.kr/p/Xv4TE8</a>)</td></tr></tbody></table><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="https://1.bp.blogspot.com/-QecBbgi7nbU/WaWggKGShMI/AAAAAAAAgrU/jwrEqnUMuR87jea1xmFL6_CeRjz6BcjyQCLcBGAs/s1600/2017-08-05-coscuo2017-04.jpg" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" data-original-height="1068" data-original-width="1600" height="266" src="https://1.bp.blogspot.com/-QecBbgi7nbU/WaWggKGShMI/AAAAAAAAgrU/jwrEqnUMuR87jea1xmFL6_CeRjz6BcjyQCLcBGAs/s400/2017-08-05-coscuo2017-04.jpg" width="400" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">▲ 講解中 by Aminzai Wang。(照片來源：<a href="https://flic.kr/p/WehwJC" target="_blank">https://flic.kr/p/WehwJC</a>)</td></tr></tbody></table><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="https://4.bp.blogspot.com/-3-T9Z9QThQk/WaWggcd35xI/AAAAAAAAgrY/E7By6r-1x98awWc-DZNe1C1t093DYL1BACLcBGAs/s1600/2017-08-05-coscuo2017-05.jpg" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" data-original-height="1068" data-original-width="1600" height="266" src="https://4.bp.blogspot.com/-3-T9Z9QThQk/WaWggcd35xI/AAAAAAAAgrY/E7By6r-1x98awWc-DZNe1C1t093DYL1BACLcBGAs/s400/2017-08-05-coscuo2017-05.jpg" width="400" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">▲ 講完這張，回公司就多了不少加速 Pipeline 相關的 issues by Aminzai Wang。(照片來源：<a href="https://flic.kr/p/Xr3YCw" target="_blank">https://flic.kr/p/Xr3YCw</a>)</td></tr></tbody></table><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="https://2.bp.blogspot.com/-dKxGy37yK0I/WaWghC4W_AI/AAAAAAAAgrg/5ldxHziuu-4brlBDnXoZFVQ98Hl7Bo-BACLcBGAs/s1600/2017-08-05-coscuo2017-06.jpg" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" data-original-height="1068" data-original-width="1600" height="266" src="https://2.bp.blogspot.com/-dKxGy37yK0I/WaWghC4W_AI/AAAAAAAAgrg/5ldxHziuu-4brlBDnXoZFVQ98Hl7Bo-BACLcBGAs/s400/2017-08-05-coscuo2017-06.jpg" width="400" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">▲ 會後於教室外繼續討論的凍仁 by Aminzai Wang。(<a href="https://flic.kr/p/WgG6Av" target="_blank">https://flic.kr/p/WgG6Av</a>)</td></tr></tbody></table><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="https://3.bp.blogspot.com/-PE8_cP91-SE/WaWvxz1DH2I/AAAAAAAAgrw/lyLLAWdR-WohjmgfbPTcOR2qz4aDGiWZQCLcBGAs/s1600/2017-08-30-continuous_delivery_with_ansible_x_gitlab-ci.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" data-original-height="768" data-original-width="1024" height="300" src="https://3.bp.blogspot.com/-PE8_cP91-SE/WaWvxz1DH2I/AAAAAAAAgrw/lyLLAWdR-WohjmgfbPTcOR2qz4aDGiWZQCLcBGAs/s400/2017-08-30-continuous_delivery_with_ansible_x_gitlab-ci.png" width="400" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">▲ 順帶一提，簡報第一頁的可愛動物是使用 <i>cowsay</i> 指令繪製而成的牛兒，不是馬喔！</td></tr></tbody></table><br /><code class="ref">相關連結：<br /><span style="color: #ffdb00;">★</span> <a href="https://gitlab.com/chusiang/coscup2017-cd-demo" target="_blank">Chu-Siang Lai / coscup2017-cd-demo · GitLab</a><br /><font color="#ffdb00">★</font> <a href="https://youtu.be/5bESRA3r0UM?t=5h24m16s" target="_blank">COSCUP 2017 現場直播影片</a>。<br /><span style="color: #ffdb00;">★</span> <a href="http://blog.chengweichen.com/2017/08/coscup-2017-ansible-gitlab-cicd.html" target="_blank">艦長，你有事嗎？: COSCUP 2017 - Ansible &amp; GitLab CI/CD workshop 101</a><br /><font color="#ffdb00">★</font> <a href="https://youtu.be/fTfyrM3TAeg" target="_blank">[COSCUP 2017][307] Ansible &amp; GitLab CI/CD workshop 101 | YouTube</a><br /><span style="color: #ffdb00;">★</span> <a href="http://coscup.org/2017/#/schedule/day1/3071450" target="_blank">COSCUP 2017 活動頁面</a><br /><span style="color: #ffdb00;">★</span> <a href="https://devops.kktix.cc/events/meetup-kaohsiung-1" target="_blank">DevOps Taiwan x Agile Kaohsiung 高雄小聚活動頁面</a><br /><span style="color: #ffdb00;">★</span> <a href="https://github.com/chusiang/automate-with-ansible/" target="_blank">《現代 IT 人一定要知道的 Ansible 自動化組態技巧》 | GitHub</a><br /><br />參考資料：<br /><span style="color: #ffdb00;">★</span> <a href="https://www.tenlong.com.tw/products/9789862019627" target="_blank">《Continuous Delivery》中文版</a><br /><span style="color: #ffdb00;">★</span> <a href="https://www.tenlong.com.tw/products/9787115403650" target="_blank">《凤凰项目：一个 IT 运维的传奇故事》</a><br /><font color="#ffdb00">★</font> <a href="https://www.tenlong.com.tw/products/9789864765867">《鳳凰專案：看 IT 部門如何讓公司從谷底翻身的傳奇故事》</a><br /></code><br />