---
title: "怎麼在 GitLab CI 用 color mode 跑 Ansible Playbooks？"
date: 2017-07-07
type: blog
author: 凍仁翔
link: http://note.drx.tw/2017/07/how-to-use-color-mode-to-run-ansible-playbooks-on-gitlab-ci.html
layout: post
comments: true
---

凍仁近日使用 Ansible 和 GitLab CI 幫公司導入持續交付 (Continuous Delivery) 時，很希望 GitLab CI 的執行結果可以像終端機 (TTY) 一樣，有便於閱讀的色彩模式 (color mode)。<br /><br />今日隨手翻了《Ansible: Up and Running》一書，便於附錄裡得到解答，真是無心插柳柳成陰啊！<br /><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="https://4.bp.blogspot.com/-daTkQ-3RaYY/WV-8S8XkhgI/AAAAAAAAgZY/yef0ItJ8gsEDKEIwMRn66cnuTge-Go4IQCLcBGAs/s1600/2017-07-08-ansible-on-gitlabci-1.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" data-original-height="791" data-original-width="810" height="390" src="https://4.bp.blogspot.com/-daTkQ-3RaYY/WV-8S8XkhgI/AAAAAAAAgZY/yef0ItJ8gsEDKEIwMRn66cnuTge-Go4IQCLcBGAs/s400/2017-07-08-ansible-on-gitlabci-1.png" width="400" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">▲ 當 force_color = 1 時，GitLab CI 的執行結果。 <a href="https://gitlab.com/chusiang/helloworld.ansible.role/-/jobs/21538921" target="_blank">(more)</a> </td></tr></tbody></table><a name='more'></a><br />我們只需在專案底下的 ansible.cfg 裡設置 <b>force_color = 1</b> 來強制讓非 TTY 環境也使用 color 模式即可。<br /><br /><blockquote>[ <span style="color: #ffdb00;">jonny</span><span style="color: red;">@el_capitan</span> <span style="color: #ad7fa8;">~</span> ]<br />$ vim ansible.cfg <span class="Ctrl">[Enter]</span><br /><span class="Type">[defaults]</span><br />...<br /><b>force_color = <span class="Constant">1</span></b></blockquote><br />其書中的附錄有提到，<b>force_color</b> 的預設值為 <b>none</b>，也就是預設只會在 TTY 裡啟用 color mode。<br /><br /><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto; text-align: center;"><tbody><tr><td style="text-align: center;"><a href="https://3.bp.blogspot.com/-eXoG3B67VX0/WV-8S0aJZ6I/AAAAAAAAgZU/ikiqbA9brwgV2EGlbz8AhXl5FQqmzXa_QCLcBGAs/s1600/2017-07-08-ansible-on-gitlabci-2.png" imageanchor="1" style="margin-left: auto; margin-right: auto;"><img border="0" data-original-height="791" data-original-width="810" height="390" src="https://3.bp.blogspot.com/-eXoG3B67VX0/WV-8S0aJZ6I/AAAAAAAAgZU/ikiqbA9brwgV2EGlbz8AhXl5FQqmzXa_QCLcBGAs/s400/2017-07-08-ansible-on-gitlabci-2.png" width="400" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">▲ GitLab CI 的預設執行結果。 <a href="https://gitlab.com/chusiang/helloworld.ansible.role/-/jobs/21539273" target="_blank">(more)</a></td></tr></tbody></table><br />套一句某同事的口頭禪：「書中自有黃金屋」，沒想到前些日子怎麼樣都找不到的答案，會是這麼得到解答。<br /><br />時間也不早了，凍仁就在此祝各位 Ansibler 晚安，希望大家能有個美好的夜晚。<br /><br /><code class="ref">資料來源： <br /><span style="color: #ffdb00;">★</span> <a href="https://www.safaribooksonline.com/library/view/ansible-up-and/9781491915318/app02.html#default_settings" target="_blank">Default Settings | Ansible: Up and Running [Book]</a><br /><span style="color: #ffdb00;">★</span> <a href="http://docs.ansible.com/ansible/intro_configuration.html#force-color">Configuration file / force_color | Ansible Documentation</a><br /><span style="color: #ffdb00;">★</span> <a href="https://github.com/ansible-tw/AMA/issues/24" target="_blank">How to show color on GitLab CI ? · Issue #24 · ansible-tw/AMA | GitHub</a><br /></code>