---
title: "如何只更換特定鍵盤的 Ctrl 和 Caps Lock 鍵位？ on Ubuntu 16.04"
date: 2017-03-18
type: blog
author: 凍仁翔
link: http://note.drx.tw/2017/03/how-to-switch-ctrl-and-caps-lock-on-specific-keyboard.html
layout: post
comments: true
---

四年前，凍仁找到了對調 <kbd>Ctrl</kbd> 和 <kbd>Caps Lock</kbd> 的方法，並紀錄於「<a href="http://note.drx.tw/2013/03/ctrl-caps-lock.html" target="_blank">對調 Ctrl 和 Caps Lock 鍵位</a>」一文，但使用 <i>setxkbmap</i> 指令操作時，會連外接不需更換鍵位的 <a href="http://note.drx.tw/2013/03/hhkb-pro2.html">HHKB Pro 2</a> 也一併生效，害得凍仁每次都得重新插拔 USB 線來排除此問題；而現在我們只需透過 <i>-device</i> 參數即可對特定鍵盤進行操作。<br /><a name='more'></a><br />1. 使用 xinput 列出所有鍵盤輸入裝置，此為 ThinkPad T410 外接 HHKB Pro 2 之結果。<br /><blockquote><pre>[ <span style="color: #ffdb00;">jonny</span><span style="color: red;">@xenial</span> <span style="color: #ad7fa8;">~</span> ]<br />$ xinput -list | grep -i key <kbd>[Enter]</kbd><br />⎣ Virtual core keyboard                    id=3  [master keyboard (2)]<br />    ↳ Virtual core XTEST keyboard          id=5  [slave  keyboard (3)]<br />    ↳ Power Button                         id=6  [slave  keyboard (3)]<br />    ↳ Video Bus                            id=7  [slave  keyboard (3)]<br />    ↳ Sleep Button                         id=8  [slave  keyboard (3)]<br />    ↳ Integrated Camera                    id=12 [slave  keyboard (3)]<br />    <font color="#ff0000">↳ AT Translated Set 2 keyboard         id=13 [slave  keyboard (3)]</font><br />    ↳ ThinkPad Extra Buttons               id=16 [slave  keyboard (3)]<br />    ↳ ACPI Virtual Keyboard Device         id=17 [slave  keyboard (3)]<br />    <font color="#ffdb00">↳ Topre Corporation HHKB Professional  id=9  [slave  keyboard (3)]</font></pre></blockquote><center>▲ ThinkPad T410 內建鍵盤的裝置名稱為 <b>AT Translated Set 2 keyboard</b>，而外接的 HHKB Pro 2 則是 <b>Topre Corporation HHKB Professional</b>。</center><br />2. 藉由 <i>setxkbmap</i> 指令搭配裝置代號 (id) 使用  即可對特定特定鍵盤進行操作。<br /><blockquote>[ <span style="color: #ffdb00;">jonny</span><span style="color: red;">@xenial</span> <span style="color: #ad7fa8;">~</span> ]<br />$ /usr/bin/setxkbmap -option "ctrl:swapcaps" <font color="#ffdb00">-device</font> <b><font color="#ff0000">13</font></b> <kbd>[Enter]</kbd><br /><br /><span class="Comment"># 此例中，裝置代號 13 指的是 ThinkPad T410 的內建鍵盤，請依自行需求進行更改。</span><br /></blockquote><br />3. 最後凍仁寫了個簡易的 Shell Script，並讓它在登入時自動執行。<br /><blockquote>[ <span style="color: #ffdb00;">jonny</span><span style="color: red;">@xenial</span> <span style="color: #ad7fa8;">~</span> ]<br />$ vi switch-capslock-and-ctrl.sh <kbd>[Enter]</kbd><br /><pre><span class="Comment">#!/bin/bash</span><br /><br /><span class="Comment"># Find the build in thinkpad keyboard device id.</span><br /><span class="Identifier">BUILDIN_KEYBOARD_ID</span>=<span class="PreProc">$(</span><span class="Special">xinput list </span><span class="Structure">|</span><span class="Special"> </span><span class="Statement">grep</span><span class="Special"> </span><span class="Structure">'</span><span class="String">AT Translated Set 2 keyboard</span><span class="Structure">'</span><span class="Special"> </span><span class="Structure">|</span><span class="Special"> awk </span><span class="Structure">'</span><span class="String">{ print $7 }</span><span class="Structure">'</span><span class="Special"> </span><span class="Structure">|</span><span class="Special"> </span><span class="Statement">sed</span><span class="Special"> </span><span class="Structure">'</span><span class="String">s/id=//</span><span class="Structure">'</span><span class="PreProc">)</span><br /><span class="Identifier">HHKB_COUNT</span>=<span class="Special">`lsusb </span><span class="Structure">|</span><span class="Special"> </span><span class="Statement">grep</span><span class="Special"> </span><span class="Structure">&quot;</span><span class="String">Topre Corporation HHKB Professional</span><span class="Structure">&quot;</span><span class="Special"> </span><span class="Structure">|</span><span class="Special"> wc </span><span class="Special">-l</span><span class="Special">`</span><br /><br /><span class="Statement">if </span><span class="Structure">[</span> <span class="PreProc">$HHKB_COUNT</span> <span class="Statement">-ne</span> <span class="Structure">&quot;</span><span class="String">1</span><span class="Structure">&quot;</span> <span class="Structure">]</span><span class="Structure">;</span> <span class="Statement">then</span><br />  /usr/bin/setxkbmap <span class="Special">-option</span> <span class="Structure">&quot;</span><span class="String">ctrl:swapcaps</span><span class="Structure">&quot;</span><br /><span class="Statement">else</span><br />  <span class="Comment"># Only switch the Caps Lock and Left Ctrl layout at ThinkPad T410.</span><br />  /usr/bin/setxkbmap <span class="Special">-option</span> <span class="Structure">&quot;</span><span class="String">ctrl:swapcaps</span><span class="Structure">&quot;</span> <span class="Special">-device</span> <span class="PreProc">$BUILDIN_KEYBOARD_ID</span><br /><span class="Statement">fi</span></pre></blockquote>▲ Reference: <a href="https://github.com/chusiang/hacking-ubuntu.ansible/" target="_blank">hacking-ubuntu.ansible</a> / files / <a href="https://github.com/chusiang/hacking-ubuntu.ansible/blob/develop/files/switch-capslock-and-ctrl.sh" target="_blank">switch-capslock-and-ctrl.sh</a> <br /><br />現在我們再也不用重新插拔 USB 線了，Happy hacking our keyboard !<br /><br /><code class="ref">站內連結：<br /><span style="color: #ffdb00;">★</span> <a href="http://note.drx.tw/2013/03/ctrl-caps-lock.html" target="_blank">對調 Ctrl 和 Caps Lock 鍵位</a><br /><br />資料來源： <br /><span style="color: #ffdb00;">★</span> <a href="http://superuser.com/a/294034/205255" target="_blank">linux - Two keyboards on one computer. When I write with A I want a US keyboard layout, when I use B I want Swedish. Possible? | Super User</a><br /></code><br />