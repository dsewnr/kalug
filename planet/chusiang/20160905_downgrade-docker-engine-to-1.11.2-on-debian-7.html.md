---
title: "於 Debian 7 手動降版至 docker-engine 1.10.3"
date: 2016-09-05
type: blog
author: 凍仁翔
link: http://note.drx.tw/2016/09/downgrade-docker-engine-to-1.11.2-on-debian-7.html
layout: post
comments: true
---

最近凍仁在 Debian 7 上升級 docker-engine 一直失敗，查看 error log 才得知 Docker 1.12.0+ 需使用 Linux Kernel 3.10.0+ 才行，但偏偏 apt 套件管理員還傻傻的把它給升上 1.12.1。若大家有相同的困擾就請先降版，再綁定 docker-engine 的版本吧！<br /><br /><div style="text-align: center;"><iframe allowtransparency="true" frameborder="0" height="212" scrolling="no" src="https://www.facebook.com/plugins/post.php?href=https%3A%2F%2Fwww.facebook.com%2Fchusiang.lai%2Fposts%2F10205254129152070&amp;width=500" style="border: none; overflow: hidden;" width="500"></iframe><br />▲ 2016/09/02 踩完雷後的凍仁碎碎唸。</div><a name='more'></a><br />1. 成功使用 apt 升級 Docker v1.12.1 了，但就是無法啟用 Docker domain。<br /><blockquote><pre>[ <span style="color: #ffdb00;">jonny</span><span style="color: red;">@wheezy</span> <span style="color: #ad7fa8;">~</span> ]<br />$ docker ps <span class="Ctrl">[Enter]</span><br />Cannot connect to the Docker daemon. Is the docker daemon running on this host?</pre></blockquote><br />2. 從 error log 中得知 Docker 1.12.0+ 只支援 Kernel 3.10.0+，不支援凍仁現在使用的 Kernel 3.2.0。<br /><blockquote><pre>[ <span style="color: #ffdb00;">jonny</span><span style="color: red;">@wheezy</span> <span style="color: #ad7fa8;">~</span> ]<br />$ tail -f /var/log/docker.log <span class="Ctrl">[Enter]</span><br />...<br />time="2016-09-03T13:13:48.974874728+08:00" level=info msg="libcontainerd: new containerd process, pid: 20966" <br />time="2016-09-03T13:13:49.977273934+08:00" level=fatal msg="Your Linux kernel version 3.2.0-4-amd64 is not supported for running docker. Please upgrade your kernel to 3.10.0 or newer."</pre></blockquote><br />3. 凍仁曾想藉由 <i>apt-get install -f</i> 來修復套件相依的問題，但都失敗了。<br /><blockquote><pre>[ <span style="color: #ffdb00;">jonny</span><span style="color: red;">@wheezy</span> <span style="color: #ad7fa8;">~</span> ]<br />$ sudo apt-get install -f <span class="Ctrl">[Enter]</span><br />The following packages will be upgraded: <br />docker-engine <br />1 packages upgraded, 0 newly installed, 0 to remove and 17 not upgraded.<br />Need to get 0 B/28.1 MB of archives. After unpacking 116 kB will be used.<br />Do you want to continue? [Y/n/?] <br />(Reading database ... 275991 files and directories currently installed.)<br />Preparing to replace docker-engine 1.12.0-0~wheezy (using .../docker-engine_1.12.1-0~wheezy_amd64.deb) ...<br />[....] Stopping Docker: dockerstart-stop-daemon: warning: failed to kill 3752: No such process<br />No process in pidfile '/var/run/docker-ssd.pid' found running; none killed.<br />invoke-rc.d: initscript docker, action "stop" failed.<br />dpkg: warning: subprocess old pre-removal script returned error exit status 1<br />dpkg: trying script from the new package instead ...<br />[....] Stopping Docker: dockerstart-stop-daemon: warning: failed to kill 3752: No such process<br />No process in pidfile '/var/run/docker-ssd.pid' found running; none killed.<br />invoke-rc.d: initscript docker, action "stop" failed.<br />dpkg: error processing /var/cache/apt/archives/docker-engine_1.12.1-0~wheezy_amd64.deb (--unpack):<br />subprocess new pre-removal script returned error exit status 1<br />dpkg: error while cleaning up:<br />subprocess installed post-installation script returned error exit status 1<br />Errors were encountered while processing:<br />/var/cache/apt/archives/docker-engine_1.12.1-0~wheezy_amd64.deb<br />E: Sub-process /usr/bin/dpkg returned an error code (1)<br />A package failed to install.  Trying to recover:<br />dpkg: error processing docker-engine (--configure):<br />Package is in a very bad inconsistent state - you should<br />reinstall it before attempting configuration.<br />Errors were encountered while processing:<br />docker-engine </pre></blockquote><br />4. 手動移除 docker-engine 套件，並修復套件庫無法正常使用之問題。<br /><blockquote><pre>[ <span style="color: #ffdb00;">jonny</span><span style="color: red;">@wheezy</span> <span style="color: #ad7fa8;">~</span> ]<br />$ sudo mv /var/lib/dpkg/info/docker-engine.* /tmp &amp;&amp; \<br />  sudo dpkg --remove --force-remove-reinstreq docker-engine &amp;&amp; \<br />  sudo apt-get remove docker-engine &amp;&amp; \<br />  sudo apt-get autoremove &amp;&amp; sudo apt-get autoclean  &amp;&amp; \<br />  sudo apt-get install -f &amp;&amp; \<br />  sudo apt-get update <span class="Ctrl">[Enter]</span></pre></blockquote><br />5. 成功移除 docker-engine 後，指定特定的版本 (v1.10.3) 安裝 docker-engine。<br /><blockquote>[ <span style="color: #ffdb00;">jonny</span><span style="color: red;">@wheezy</span> <span style="color: #ad7fa8;">~</span> ]<br />$ sudo apt-get install docker-engine=1.10.3-0~wheezy <span class="Ctrl">[Enter]</span></blockquote><br />6. 綁定 docker-engine 版本。<br /><blockquote>[ <span style="color: #ffdb00;">jonny</span><span style="color: red;">@wheezy</span> <span style="color: #ad7fa8;">~</span> ]<br />$ sudo apt-mark hold docker-engine <span class="Ctrl">[Enter]</span><br />docker-engine set on hold.</blockquote><br />現在凍仁又可以開心的在 Debian 7 裡把玩 docker 了，省下重灌電腦的時間可以寫好多好多的筆記啊！<br /><br /><div style="text-align: center;"><iframe allowtransparency="true" frameborder="0" height="165" scrolling="no" src="https://www.facebook.com/plugins/post.php?href=https%3A%2F%2Fwww.facebook.com%2Fchusiang.lai%2Fposts%2F10205209667680561&amp;width=500" style="border: none; overflow: hidden;" width="500"></iframe><br />▲ 2016/08/28 剛踩到雷超想重灌電腦，又沒時間的凍仁碎碎唸。</div><br /><h2 class="date-header"><span>2016-09-25</span></h2><br />今日發現 Docker 1.11.2 在 Kernel 3.2 上還是有些問題，故再次將 Docker 降版至 1.10.3，並修正此文章。<br /><br /><code class="ref">資料來源： <br /><font color="#ffdb00">★</font> <a href="http://askubuntu.com/a/510887" target="_blank">How to fix &quot;Package is in a very bad inconsistent state&quot; error? | Ask Ubuntu</a><br /><span style="color: #ffdb00;">★</span> <a href="http://askubuntu.com/a/428775/74671" target="_blank">software installation - How to install specific version of some package? | Ask Ubuntu</a><br /><span style="color: #ffdb00;">★</span> <a href="http://askubuntu.com/questions/18654/how-to-prevent-updating-of-a-specific-package" target="_blank">updates - How to prevent updating of a specific package? - Ask Ubuntu</a><br /><span style="color: #ffdb00;">★</span> <a href="http://blog.csdn.net/Feng______/article/details/51524699" target="_blank">安裝docker失敗記錄 - Feng______</a><br /></code><br />